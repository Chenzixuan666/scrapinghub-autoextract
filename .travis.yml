language: python

branches:
  only:
    - master
    - /^\d\.\d+$/
    - /^\d\.\d+\.\d+(rc\d+|\.dev\d+)?$/

matrix:
  include:
    - python: 3.5
      env: TOXENV=py35
    - python: 3.6
      env: TOXENV=py36
    - python: 3.7
      env: TOXENV=py37
    - python: 3.6
      env: TOXENV=mypy

install:
- pip install -U tox codecov

script: tox

after_success:
- codecov

deploy:
  provider: pypi
  user: "__token__"
  distributions: "sdist bdist_wheel"
  password:
    secure: "Zx1dAKmventV9sCdJ3UVXt296VF+b0sd1YqDED/ZUDAPad3lZf9Km4iArc+qrSqOrl9DJj1nyiR6H2+xZkGmjYtzmKVN5dnXPPyxjA3oZjV9AZlOXP1sPEulyraStHdMWgds2u7WCRUkwGmmfK7AyyXlFT8prnHJQ7HZZ8+XDq/4p7NkPcY1gIz0A1TGBif4PrxVS5c/WajzwGAGh0MsJkiJjb954Szcy9OjBhQxtYO922qcUt0lhGZLQOW/TF2162Fp+9OX5TppXYOGbdZoNz8HNg7fHXuAjrVdX0G9HgWtIiZFhXA2xzBgJZGL3eD34n6CBip4hbvaoTMn1nWLvDGpuyGl0KqyzqyABFu9OfCVcyjeOwuAgzq5IWcCHGbhG1uaN02zA4KY3JXBPfNFQtYTdyTnICEGPquIxS8ovOF8i69EGfUs3zEZzPXfF9dGV6euz4n9Z/1kXUQbdj7jVGVcRodmD/n8hVsanmtk1VZvVEyYTwgmGt9xje9pzotaB0KacK74al649W+jFDrLBXB0fHx4Xt4sfzyZk+sXlqS4Tyb8Bkx3D+YwqDlj4KtZVvufZMHekKBm5W19ztIeOsnlBA8wvVYUjI3fuXF2DIsBX+McQs74msdTOsMlxtXE/iVzWhJ65swQSMr2t8FqWcA2M2kmHGeZJ7o9nfK2acY="
  on:
    tags: true
    repo: scrapinghub/scrapinghub-autoextract
    condition: $TOXENV == py37
