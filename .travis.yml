language: python

branches:
  only:
    - master
    - /^\d\.\d+$/
    - /^\d\.\d+\.\d+(rc\d+|\.dev\d+)?$/

matrix:
  include:
    - python: 3.5
      env: TOXENV=py35
    - python: 3.6
      env: TOXENV=py36
    - python: 3.7
      env: TOXENV=py37
    - python: 3.6
      env: TOXENV=mypy

install:
- pip install -U tox codecov

script: tox

after_success:
- codecov

deploy:
  provider: pypi
  user: "__token__"
  distributions: "sdist bdist_wheel"
  password:
    secure: "Nqypf7Kt5sGu23AkoIf9St1O45FRQW6EKVzY5QuVoS4NsTGinqeveFgB4DSNwTFH21BkCoYn173MBpXu+ABCnW8uCbKutB8xvgVJhE1lxJVcHSUc6O9+fpdDc1UWIw2iTrDqmWEEnUEwm9hmUkUBp90XzWQpqKF/mw6RCZzIiwmp0rSHsgEYU8EpYix6otu1um4hX6ee1hOD7pM4+PIfbtyr2PfOq/Omyb3SkvCWMrVwQ5lBL7Ihn9Lp6/jLhecFwTRZW/qHjV48RuZxv52zIIcKbCbqTSIA5armKhjrZ7//0O5mPBfTYJrki7LKREHiGUKmJrj5RbdgbP8GLdnVtRjnuwdVzcLHW6ystucxCw2f1M9c2+pu3tWsxek3Hz1gEVJCyVpKLuD7VZbvDI/LbCWdbIO6Ir6+dmZRFPuIrzxalv6tBklmPXvGiXm28LOk1eqDq6btnCa7XMb2G2+KGK0Floz9gWmheaAriTBViUdUoqPlz8QdViWYE1jJAvwDM9TMx/k6kk0sn5PB1ovap9jBQxbsG5GVo2T17FIawav+A3MedjSck4wglkUGxpYC8D4RqI4gQ4ISNj1CFoII5jIUdyf3vDJ5IFFZINquwDI2gg7ZMMMT1hjHz4qrP0VCT+ycsZstrGY6RcZbdK4MiswDtSc993HCPywYyYUuqBI="
  on:
    tags: true
    repo: scrapinghub/scrapinghub-autoextract
    condition: $TOXENV == py37
